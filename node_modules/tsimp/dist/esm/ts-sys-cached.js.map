{"version":3,"file":"ts-sys-cached.js","sourceRoot":"","sources":["../../src/ts-sys-cached.ts"],"names":[],"mappings":"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","sourcesContent":["import { cached, cachedMtime } from '@isaacs/cached'\nimport { catcher, catchWrap } from '@isaacs/catcher'\nimport {\n  BigIntStats,\n  Dirent,\n  readdirSync,\n  readFileSync,\n  realpathSync,\n  Stats,\n  statSync,\n} from 'fs'\nimport { isAbsolute, relative, resolve, sep } from 'path'\nimport { fileURLToPath, pathToFileURL } from 'url'\nconst cwd = process.cwd()\n\nexport const normalizeSlashes = (path: string): string =>\n  path.includes('\\\\') ? path.replace(/\\\\/g, '/') : path\n\nexport const readFile = cachedMtime(\n  catchWrap((p: string) => readFileSync(p, 'utf8'), undefined)\n)\n\nconst safeStat = catchWrap(statSync)\nexport const directoryExists = cached(\n  (p: string) => !!safeStat(p)?.isDirectory()\n)\nexport const fileExists = cached(\n  (p: string) => !!safeStat(p)?.isFile()\n)\n\nexport const realpath = cachedMtime((path: string) =>\n  catcher(() => realpathSync(path, 'utf8'), path)\n)\n\nexport const getCurrentDirectory = () => cwd\n\n/* c8 ignore start */\nconst pathHasTrailingSlash =\n  sep === '/'\n    ? (p: string) => p.endsWith('/')\n    : (p: string) => p.endsWith('/') || p.endsWith(sep)\n/* c8 ignore stop */\n\nexport const normalizePath = cached((path: string): string => {\n  const trailingSlash = pathHasTrailingSlash(path)\n  path = normalizeSlashes(path)\n  const isFileUrl = path.startsWith('file://')\n  if (isFileUrl) path = fileURLToPath(path)\n  const isAbs = isFileUrl || isAbsolute(path)\n  path = resolve(path)\n  if (!isAbs) path = relative(cwd, path)\n  if (isFileUrl) path = String(pathToFileURL(path))\n  path = normalizeSlashes(path)\n  if (trailingSlash) path += '/'\n  if (sep === '\\\\') {\n    // capitalize drive letters and UNC host/share names.\n    path = path.replace(/^([a-z]:\\/|\\/\\/[^\\/]+\\/[^\\/]+)/, $ =>\n      $.toUpperCase()\n    )\n  }\n  return path\n})\n\nexport interface FileSystemEntries {\n  files: string[]\n  directories: string[]\n}\nconst emptyFileSystemEntries: FileSystemEntries = {\n  files: [],\n  directories: [],\n}\n\nconst getFileSystemEntries = cachedMtime(\n  catchWrap((path: string): FileSystemEntries => {\n    const entries = readdirSync(path || '.', { withFileTypes: true })\n    const files: string[] = []\n    const directories: string[] = []\n    for (const dirent of entries) {\n      const entry = dirent.name\n      let stat: Dirent | Stats | BigIntStats | undefined\n      /* c8 ignore start */\n      if (entry === '.' || entry === '..') continue\n      /* c8 ignore stop */\n      if (dirent.isSymbolicLink()) {\n        stat = safeStat(resolve(path, entry))\n      } else {\n        stat = dirent\n      }\n      if (stat?.isFile()) files.push(entry)\n      else if (stat?.isDirectory()) directories.push(entry)\n    }\n    files.sort((a, b) => a.localeCompare(b, 'en'))\n    directories.sort((a, b) => a.localeCompare(b, 'en'))\n    return { files, directories }\n  }, emptyFileSystemEntries)\n)\n\nexport const getDirectories = (path: string) =>\n  getFileSystemEntries(path).directories\n\nexport const getFiles = (path: string) =>\n  getFileSystemEntries(path).files\n"]}